{% extends 'base.html.twig' %}

{% block title %}
	{{post.title}}
{% endblock %}


{% block body %}

	{% set order = 1 %}


	{% set mainPicture = null %}
	{% set defaultPicture = asset('img/default-image.png') %}
	{# loop in pictures to find picture with sort_order = 1 #}
	{% for picture in post.pictures %}
		{% if picture.sortOrder == 1 %}
			{% set mainPicture = picture %}
		{% endif %}
	{% endfor %}

	<header class="masthead post-show" style="background-image: url('{{ '/img/' ~ mainPicture.name|default('../img/default-image.png') }}')" alt="Une image de l'article ">

		<div class="overlay"></div>
		<div class="container">
			<div class="row">
				<div class="col-lg-8 col-md-10 mx-auto">
					<div class="post-heading">
						<h1>{{post.title}}</h1>
						<h2 class="subheading">{{post.heading}}</h2>
						<span class="meta">Posté par {{post.author.firstname}}&nbsp{{post.author.lastname}} &nbsp le &nbsp{{post.createdAt|date('d/m/y')}}&nbsp à &nbsp{{post.createdAt|date('H:i')}}</div></span>
					</div>
				</div>
			</div>
		</div>

		{% if mainPicture %}
			<a data-toggle="collapse" href={{"#update_picture_input" ~ mainPicture.id }} role="button" aria-expanded="false" aria-controls={{"update_picture_input" ~ mainPicture.id }}>
				<i class="fas fa-pencil-alt fa-2x" title="remplacer l'image"></i>
			</a>

		{% endif %}
		{#---------DELETE PICTURE---------#}
		<a href="{{ path('picture_delete', { id: mainPicture.id }) }}" data-delete>
			<i class="fas fa-trash-alt fa-2x" title="supprimer l'image"></i>
		</a>

		{#!---------UPDATE PICTURE HIDDEN INPUT---------#}
		<div class="collapse" id={{"update_picture_input" ~ mainPicture.id }}>
			<input type="file"/>
			<div hidden>{{ mainPicture.id }}</div>
			<div hidden>{{ post.id }}</div>
			<div hidden>{{ mainPicture.sortOrder }}</div>
			<!-- Picture sortOrder -->
			<button data-update>Envoyer</button>
		</div>
	</header>

	<p class="lead mt-4 mb-4 col-10 mx-auto">{{ post.description|nl2br }}</p>
	<div class="row justify-content-center ">
		<div class="col-lg-8">

			<div class="row justify-content-center mt-4 mb-4">

				<div class="col-sm-8 text-center">
					<div class="meta">{{ post.author.firstname ~ ' ' ~ post.author.lastname }}
						&nbsp le &nbsp{{post.createdAt|date('d/m/y')}}&nbsp à &nbsp{{post.createdAt|date('H:i')}}</div>
				</div>

			</div>
		</div>
	</div>


	<a class="btn btn-primary" href="http://snowtricks.philippe-j.fr">Allons voir</a>
	{% if app.user %}
		<a class="btn btn-primary" href="{{ path('post_update', {id:post.id}) }}">Modifier</a>
		<a class="btn btn-primary" href="{{ path('post_desactivate', {id:post.id}) }}" onclick="return confirm('Êtes-vous certain de vouloir désactiver cet article ?')">Supprimer</a>
	{% endif %}
</div>{% endblock %}{% block javascripts %}
<script src=" {{ asset('js/media_delete.js') }} "></script>
<script src=" {{ asset('js/media_update.js') }} "></script>{% endblock %}
